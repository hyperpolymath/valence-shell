// SPDX-License-Identifier: PMPL-1.0-or-later
= Changelog

All notable changes to Valence Shell will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

**Note**: Versions 0.x.x are pre-release. Breaking changes may occur between minor versions.

== [Unreleased]

=== Planned
- Glob expansion (*.txt, ?.rs, [a-z]*)
- Quote processing (proper escaping, single/double quotes)
- Full POSIX shell compliance (subset)
- RMO (Remove-Match-Obliterate) proofs for GDPR compliance

== [0.14.0] - 2026-01-29

=== Added
- **Phase 6 M7-M10: Advanced Shell Features**
  - Process substitution (<(cmd) and >(cmd)) with FIFO-based implementation
  - Arithmetic expansion ($((expr)) with +, -, *, /, %, ** operators)
  - Here documents (<<DELIMITER with expansion, <<-DELIMITER with tab stripping)
  - Here strings (<<<word for single-line input)
  - Full job control implementation:
    - Background execution with & operator
    - Job table with specifications (%1, %+, %-, %name, %?pattern)
    - fg command with terminal control (tcsetpgrp)
    - bg command with SIGCONT for resuming stopped jobs
    - kill command with signal parsing (numbers and names)
    - Process group management for job control
    - Job signal handling (SIGTERM, SIGKILL, SIGCONT)

- **Phase 6 M11: Shell Variables (Discovered Complete)**
  - Variable storage in ShellState (HashMap, export tracking, positional params)
  - Variable tokenization ($VAR, ${VAR}, special params)
  - Variable expansion with environment fallback
  - Assignment parsing and execution (VAR=value)
  - Export command (export VAR=value)
  - Integration with commands, arithmetic, command/process substitution

- **Fuzzing Infrastructure**
  - Comprehensive fuzzing with cargo-fuzz
  - 4 fuzz targets: parser, arithmetic, job specs, signal parsing
  - FUZZING.md documentation guide
  - CI-ready fuzzing configuration

- **Phase 4: Rust-Lean Correspondence**
  - Created correspondence design document (PHASE4_CORRESPONDENCE_DESIGN.md, 400+ lines)
  - Created detailed correspondence mapping (PHASE4_CORRESPONDENCE.md, 600+ lines)
  - 15 correspondence tests covering Lean theorems
  - State, operation, precondition, effect, and reversibility correspondence
  - 85% confidence in Rust-Lean equivalence (informal argument + tests)

=== Testing
- All tests passing (177 total: 131 unit + 27 integration + 19 property)
- Added 17 job control tests
- Added 15 correspondence tests
- Background job execution verified
- Signal handling verified

=== Statistics
- Phase 6 progress: 11/14 milestones complete (78%)
- Overall completion: 82%
- Rust CLI: 95% complete, production-ready

=== Documentation
- PHASE6_M10_DESIGN.md (job control)
- PHASE6_M11_DESIGN.md (variables)
- PHASE6_M11_COMPLETE.md (variable completion report)
- PHASE4_CORRESPONDENCE_DESIGN.md (verification approach)
- PHASE4_CORRESPONDENCE.md (detailed mapping)
- FUZZING.md (fuzzing guide)

== [0.7.3] - 2026-01-28

=== Added
- **Phase 6 M3: Unix Pipelines**
  - Pipeline operator (|)
  - Multi-stage pipeline execution (cmd1 | cmd2 | cmd3)
  - Stdio chaining via Stdio::piped()
  - Exit code from last stage (POSIX behavior)
  - Pipeline error handling with undo support
  - SIGINT handling for entire pipeline
  - Final redirections tracked for undo
  - 7 pipeline integration tests

=== Statistics
- All tests passing (104/104: 58 unit + 27 integration + 19 property)

=== Documentation
- Updated GETTING_STARTED.md with Pipelines section
- Pipeline examples in documentation

== [0.7.2] - 2026-01-28

=== Added
- **Phase 0: Sealing (Foundation Hardening)**
  - SIGINT handling (Ctrl+C interrupts commands, not shell)
  - Error recovery (no silent state persistence failures)
  - Transaction rollback error reporting
  - Test fixtures migration (modern test_sandbox)
  - Getting Started guide and examples
  - GitHub Actions CI pipeline
  - Comprehensive API documentation (rustdoc)

=== Infrastructure
- GitHub Actions CI/CD pipeline operational
- All documentation builds without warnings
- Rust documentation (rustdoc) complete

== [0.7.1] - 2026-01-28

=== Added
- **Phase 6 M2: I/O Redirections**
  - Output redirection (>)
  - Input redirection (<)
  - Append redirection (>>)
  - Error redirection (2>, 2>>)
  - Combined redirection (&>, 2>&1)
  - Redirection undo support (file modifications reversible)
  - Redirection parser with proper precedence
  - File truncate/append tracking for undo

=== Statistics
- All tests passing (90/90: 44 unit + 27 integration + 19 property)

=== Documentation
- PHASE6_M2_COMPLETE.md

== [0.7.0] - 2026-01-28

=== Added
- **Phase 6 M1: Simple Command Execution**
  - Parser extension for external commands
  - External command execution via std::process::Command
  - PATH lookup and executable discovery
  - Exit code tracking in ShellState
  - stdio inheritance (stdin/stdout/stderr)
  - Updated REPL with new parser and external execution

- **Architecture Documentation**
  - LEAN4_RUST_CORRESPONDENCE.md
  - ECHIDNA_INTEGRATION.md
  - ARCHITECTURE.md
  - POSIX_COMPLIANCE.md with 14-milestone roadmap

- **OCaml Extraction Pipeline**
  - Designed Lean 4 → C → OCaml/Zig extraction pipeline
  - Created proofs/lean4/Extraction.lean (270 lines)
  - Created impl/ocaml/lean_wrapper.c (300 lines)
  - Created impl/ocaml/valence_lean.ml (200 lines)
  - Created impl/zig/src/lean_bindings.zig (400 lines)
  - Architecture: Lean 4 → C → liblean_vsh.so → OCaml/Zig FFI
  - 2,820 lines of code + 1,400 lines of documentation
  - Design 85% complete (C wrapper marshaling TODO)

=== Statistics
- All tests passing (27/27: 13 unit + 14 integration)
- Manual testing successful (ls, echo, pwd working)

=== Documentation
- PHASE6_M1_DESIGN.md
- EXTRACTION_SUMMARY.md (500 lines)
- docs/OCAML_EXTRACTION.md (600 lines)
- docs/ZIG_LEAN_EXTRACTION.md (700 lines)

== [0.6.0] - 2025-12-01

=== Added
- **Phase 3 Extended: Advanced File Operations**
  - File copy/move operations
  - Symbolic link support
  - Content composition theorems
  - Isabelle and Mizar content operations

=== Changed
- Extended proof coverage for file operations
- Completed all Phase 3 planned features

== [0.5.0] - 2025-11-22

=== Added
- **Phase 3 Initial: File Content Operations**
  - File content read/write operations in Coq (~330 lines)
  - File content operations in Lean 4 (~210 lines)
  - File content operations in Agda (~180 lines)
  - Proven reversibility: `write(old, write(new, fs)) = fs`
  - Proven independence: operations on different paths don't interfere
  - State capture/restore for undo/redo
  - FileModificationRecord for MAA audit trail

- **Equivalence Theory Completion**
  - Mizar equivalence proofs (~190 lines)
  - All 5 manual proof assistants now have complete equivalence theory
  - CNO = identity element proven in 5 systems

=== Statistics
- Proof files: 23 → 27
- Proof lines: ~3,180 → ~4,280
- Total theorems: ~217 → ~256
- Systems with equivalence: 4/5 → 5/5 ✅
- Systems with content ops: 0 → 3

=== Documentation
- docs/PHASE3_INITIAL_REPORT.md (comprehensive phase report)

== [0.4.0] - 2025-11-22

=== Added
- **Phase 2: Composition & Equivalence Theory**
  - Composition theorems in Coq, Lean 4, Agda, Isabelle
  - Equivalence relations in Coq
  - Z3 SMT encoding for automated verification
  - CNO (Certified Null Operations) connection
  - Mizar composition framework

- **Infrastructure**
  - Containerfile for reproducible builds
  - Complete justfile with 25+ recipes
  - scripts/verify-proofs.sh multi-prover orchestration

=== Fixed
- Agda composition admitted lemmas completed
- Isabelle composition `sorry` statements resolved

=== Statistics
- Proof files: 19 → 23 (+4)
- Proof lines: ~2,280 → ~3,180 (+900)
- Total proofs: ~130 → ~217 (+87)

=== Documentation
- docs/PHASE2_REPORT.md
- SESSION_COMPLETE.md
- INTEGRATION_SUMMARY.md

== [0.3.0] - 2025-11-22 (Early)

=== Added
- **Isabelle/HOL and Mizar Support**
  - Filesystem model in Isabelle/HOL
  - File operations in Isabelle/HOL
  - Filesystem model in Mizar
  - File operations in Mizar
  - Cross-validation across 5 proof systems

=== Changed
- Expanded to 5 proof assistants (was 3)
- Polyglot verification now includes different logical foundations

== [0.2.0] - 2025-11-21

=== Added
- **Lean 4 and Agda Support**
  - Complete filesystem model in Lean 4
  - Complete file operations in Lean 4
  - Complete filesystem model in Agda
  - Complete file operations in Agda
  - Cross-validation between dependent type theories

=== Changed
- Proofs now in 3 systems: Coq, Lean 4, Agda
- Improved proof modularity

=== Documentation
- Added proof system comparison documentation

== [0.1.0] - 2025-11-20

=== Added
- **Initial Coq Proofs**
  - Filesystem model with paths, nodes, permissions
  - mkdir/rmdir operations with reversibility proof
  - create_file/delete_file operations with reversibility proof
  - POSIX error modeling (EEXIST, ENOENT, EACCES, etc.)
  - Extraction framework to OCaml

- **OCaml Implementation**
  - FFI to POSIX syscalls
  - Audit logging hooks for MAA
  - Path resolution and sandboxing

- **Elixir Reference Implementation**
  - Matches Coq specification
  - POSIX error handling
  - Reversible operations (RMR primitives)

- **Core Theorems** (Coq only)
  - `mkdir_rmdir_reversible`
  - `create_delete_file_reversible`
  - `operation_independence`
  - `path_preservation`
  - Error code correctness

=== Documentation
- CLAUDE.md (AI assistant context)
- docs/PROGRESS_REPORT.md
- docs/ARCHITECTURE.adoc
- proofs/README.md

=== Infrastructure
- justfile build automation
- scripts/demo_verified_operations.sh
- Nix flake for reproducible builds
- GitLab CI/CD configuration

== [0.0.1] - 2025-11-19

=== Added
- Initial project structure
- Basic MAA framework concepts
- RMO/RMR primitive definitions (abstract lists only)
- Repository setup (GitLab primary, GitHub mirror)

=== Documentation
- Initial README
- Vision and goals document

---

== Version Numbering

**Current status**: Pre-1.0 (Research Prototype)

- **0.x.x**: Research and development
  - Breaking changes allowed
  - Formal proofs stable
  - Implementation unstable

- **1.0.0**: Production-ready (future)
  - Extraction gap closed
  - FFI verified
  - Security audit complete
  - Breaking changes follow semver

== Upgrade Notes

=== 0.4.0 → 0.5.0

**New capabilities**:
- File content operations available
- Can now read/write file contents with proven reversibility

**Breaking changes**:
- None (additive only)

**Migration**:
- No migration needed
- New features are opt-in

=== 0.3.0 → 0.4.0

**New capabilities**:
- Operation sequences
- Equivalence relations
- CNO = identity element

**Breaking changes**:
- None (proof additions only)

== Future Releases

=== Planned for 0.15.0
- [ ] Glob expansion (*.txt, ?.rs, [a-z]*)
- [ ] Quote processing (proper escaping, single/double quotes)
- [ ] Variables in redirections (edge case fix)
- [ ] Expanded correspondence tests (15 → 25+ property tests)

=== Planned for 0.16.0
- [ ] Echidna validation pipeline integration
- [ ] Property-based build validation
- [ ] Continuous fuzzing in CI/CD

=== Planned for 0.17.0
- [ ] RMO (obliterative deletion) proofs
- [ ] GDPR compliance primitives
- [ ] Secure overwrite guarantees

=== Planned for 0.18.0
- [ ] Access control modeling
- [ ] Capability-based security
- [ ] Enhanced MAA framework

=== Planned for 1.0.0 (Production Ready)
- [ ] Extraction gap closed (Lean → Rust formal verification)
- [ ] Full verification stack
- [ ] Verify FFI layer
- [ ] Security audit complete
- [ ] Performance optimization
- [ ] Complete POSIX compliance (subset)
- [ ] Fuzzing campaign complete

== Contributing

See [CONTRIBUTING.md](CONTRIBUTING.md) for how to contribute to future releases.

---

**Maintained by**: See [MAINTAINERS.md](MAINTAINERS.md)
**License**: Palimpsest-MPL 1.0 or later (see link:LICENSE[LICENSE])
